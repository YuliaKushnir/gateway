server:
  port: 1000
  error:
    include-message: always
    include-binding-errors: always

spring:
  application.name: gateway-service
#  config:
#    import: optional:consul:/
  cloud:
#    consul:
#      host: localhost
#      port: 8500
#      discovery:
#        health-check-path: /health

    gateway:
      server:
        default-filters:
          - TokenRelay
        routes:
          - id: posts-service-route
  #          uri: lb://posts-service
            uri: http://${POSTS_SERVICE_HOST:posts-service}:${POSTS_SERVICE_PORT:8081}
            predicates:
              - Path=/api/post/**
            filters:
              - RewritePath=/api/post/(?<remaining>.*), /api/post/${remaining}
          - id: users-service-route
            uri: http://${POSTS_SERVICE_HOST:posts-service}:${POSTS_SERVICE_PORT:8081}
  #          uri: lb://posts-service
            predicates:
              - Path=/api/user/**
#        - id: mail-service-route
#          uri: ${MAIL_SERVICE_HOST:mail-service}:${MAIL_SERVICE_PORT:8081}

        #          - id: comment_route
        #            uri: lb://comments-service
        #            predicates:
        #              - Path=/api/comment/**
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope: openid, profile, email
            redirect-uri: "http://34.118.68.15.nip.io/login/oauth2/code/google"
            client-name: Google
            client-authentication-method: client_secret_basic
            authorization-grant-type: authorization_code
        provider:
          google:
            issuer-uri: https://accounts.google.com
      resourceserver:
        jwt:
          issuer-uri: https://accounts.google.com


resilience4j:
  circuitbreaker:
    instances:
      services:
        wait-duration-in-open-state: 10s
        failure-rate-threshold: 60
        slow-call-duration-threshold:
          - 2s
        minimum-number-of-calls: 3
        permitted-number-of-calls-in-half-open-state: 1

management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      base-path: /
      exposure:
        include: "*"